{"version":3,"file":"compository-install-dna-dialog.js","sourceRoot":"","sources":["../../src/elements/compository-install-dna-dialog.ts"],"names":[],"mappings":"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","sourcesContent":["import { Constructor, html, LitElement, property, query } from 'lit-element';\nimport { Dialog } from 'scoped-material-components/mwc-dialog';\nimport { Button } from 'scoped-material-components/mwc-button';\nimport { TextField } from 'scoped-material-components/mwc-textfield';\nimport { membraneContext } from '@holochain-open-dev/membrane-context';\nimport { ScopedElementsMixin as Scoped } from '@open-wc/scoped-elements';\nimport { AdminWebsocket, DnaFile } from '@holochain/conductor-api';\nimport { sharedStyles } from './sharedStyles';\nimport { serializeHash } from '@holochain-open-dev/common';\n\nexport class CompositoryInstallDnaDialog extends membraneContext(\n  Scoped(LitElement) as Constructor<LitElement>\n) {\n  @property({ type: Object })\n  dnaFile!: DnaFile;\n\n  @query('#dialog')\n  _dialog!: Dialog;\n\n  @property({ type: String })\n  _dnaPath!: string;\n\n  open(opened = true) {\n    this._dialog.open = opened;\n  }\n\n  async installDna() {\n    const adminWs = this.membraneContext.adminWebsocket as AdminWebsocket;\n    const agentKey = await adminWs.generateAgentPubKey();\n    const installed_app_id = `generated-app-${Date.now() % 1000}`;\n\n    const dnaHash = await adminWs.registerDna({\n      source: { dna_file: this.dnaFile },\n    });\n\n    const result = await adminWs.installApp({\n      agent_key: agentKey,\n      dnas: [\n        {\n          hash: dnaHash,\n          nick: installed_app_id,\n        },\n      ],\n      installed_app_id,\n    });\n    await adminWs.activateApp({ installed_app_id });\n\n    this.dispatchEvent(\n      new CustomEvent('dna-installed', {\n        detail: { cellId: result.cell_data[0][0] },\n        bubbles: true,\n        composed: true,\n      })\n    );\n    this.open(false);\n  }\n\n  render() {\n    return html`\n      <mwc-dialog id=\"dialog\" heading=\"Install new DNA\">\n        ${this.dnaFile\n          ? html`\n              <div class=\"column\">\n                <span>Name: ${this.dnaFile.dna.content.name}</span>\n                <span\n                  >Hash:\n                  ${serializeHash(new Uint8Array(this.dnaFile.dna.hash))}</span\n                >\n                <span style=\"margin-top: 8px;\"\n                  >Are you sure you want to install this DNA?</span\n                >\n              </div>\n            `\n          : html`\n              <mwc-textfield\n                id=\"dna-path\"\n                placeholder=\"Dna.gz path\"\n                required\n                @input=${(e: any) => (this._dnaPath = e.target.value)}\n              >\n              </mwc-textfield>\n            `}\n\n        <mwc-button\n          slot=\"primaryAction\"\n          .disabled=${!this._dnaPath && !this.dnaFile}\n          @click=${() => this.installDna()}\n        >\n          Install\n        </mwc-button>\n        <mwc-button slot=\"secondaryAction\" dialogAction=\"cancel\">\n          Cancel\n        </mwc-button>\n      </mwc-dialog>\n    `;\n  }\n\n  static get scopedElements() {\n    return {\n      'mwc-dialog': Dialog,\n      'mwc-button': Button,\n      'mwc-textfield': TextField,\n    };\n  }\n\n  static get styles() {\n    return sharedStyles;\n  }\n}\n"]}